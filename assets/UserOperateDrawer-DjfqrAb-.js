var y=Object.defineProperty;var H=(r,e,t)=>e in r?y(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var x=(r,e,t)=>H(r,typeof e!="symbol"?e+"":e,t);import{r as g,dY as _,e as M,ay as E,w as N,f as U,Q as D,B as G,k as d,J as B}from"./index-JIW16VMo.js";import{i as $,s as q,a as z,b as V,u as J}from"./subscribeFocus-DcetJlM4.js";import{a as Q,i as X,d as Y}from"./debounce-CZd4bA6x.js";import{a as Z,u as R}from"./index-dB2R57H_.js";import{R as b,u as k,e as I}from"./index-DvjcH3NB.js";import{a as L}from"./system-manage-Bi2jVf84.js";import{F as P}from"./form-6Ef0Syrt.js";import{D as W}from"./index-CmflFssI.js";import{F as K}from"./index-BMTMSp2Q.js";import{I as w}from"./index-BD6mvzd_.js";import{S as ee}from"./index-DQuyM4Yp.js";import"./_baseGetTag-Cog24rK4.js";import"./tslib.es6-CwN1OpI9.js";import"./index-D1NhzyzB.js";import"./index-2F6EUax_.js";import"./row-DlyPbZr5.js";import"./responsiveObserver-yE3NW6DQ.js";import"./use-loading-ByGqktu6.js";import"./index-B4_l9AXv.js";import"./index-C_G3QvNW.js";import"./EllipsisOutlined-BDNKaE4l.js";import"./index-DosXM56V.js";import"./PurePanel-jJ__j8IN.js";import"./useBreakpoint-B_4BJZRz.js";import"./index-TjkTr2al.js";import"./index-Bt6Ty2GR.js";import"./SearchOutlined-DzCQAdpp.js";import"./index-CC3aU_xF.js";function T(r,e){var t=g.useRef({deps:e,obj:void 0,initialized:!1}).current;return(t.initialized===!1||!_(t.deps,e))&&(t.deps=e,t.obj=r(),t.initialized=!0),t.obj}var re=Q,te=X,ne="Expected a function";function se(r,e,t){var n=!0,i=!0;if(typeof r!="function")throw new TypeError(ne);return te(t)&&(n="leading"in t?!!t.leading:n,i="trailing"in t?!!t.trailing:i),re(r,e,{leading:n,maxWait:e,trailing:i})}var ie=se;const ue=M(ie),A=new Map,oe=(r,e,t)=>{const n=A.get(r);n!=null&&n.timer&&clearTimeout(n.timer);let i;e>-1&&(i=setTimeout(()=>{A.delete(r)},e)),A.set(r,{...t,timer:i})},ae=r=>A.get(r),F=new Map,le=r=>F.get(r),ce=(r,e)=>{F.set(r,e),e.then(t=>(F.delete(r),t)).catch(()=>{F.delete(r)})},j={},me=(r,e)=>{j[r]&&j[r].forEach(t=>t(e))},S=(r,e)=>(j[r]||(j[r]=[]),j[r].push(e),function(){const n=j[r].indexOf(e);j[r].splice(n,1)}),fe=(r,{cacheKey:e,cacheTime:t=5*60*1e3,staleTime:n=0,setCache:i,getCache:s})=>{const u=g.useRef(),c=g.useRef(),f=(o,a)=>{i?i(a):oe(o,t,a),me(o,a.data)},l=(o,a=[])=>s?s(a):ae(o);return T(()=>{if(!e)return;const o=l(e);o&&Object.hasOwn(o,"data")&&(r.state.data=o.data,r.state.params=o.params,(n===-1||new Date().getTime()-o.time<=n)&&(r.state.loading=!1)),u.current=S(e,a=>{r.setState({data:a})})},[]),E(()=>{var o;(o=u.current)==null||o.call(u)}),e?{onBefore:o=>{const a=l(e,o);return!a||!Object.hasOwn(a,"data")?{}:n===-1||new Date().getTime()-a.time<=n?{loading:!1,data:a==null?void 0:a.data,error:void 0,returnNow:!0}:{data:a==null?void 0:a.data,error:void 0}},onRequest:(o,a)=>{let m=le(e);return m&&m!==c.current?{servicePromise:m}:(m=o(...a),c.current=m,ce(e,m),{servicePromise:m})},onSuccess:(o,a)=>{var m;e&&((m=u.current)==null||m.call(u),f(e,{data:o,params:a,time:new Date().getTime()}),u.current=S(e,v=>{r.setState({data:v})}))},onMutate:o=>{var a;e&&((a=u.current)==null||a.call(u),f(e,{data:o,params:r.state.params,time:new Date().getTime()}),u.current=S(e,m=>{r.setState({data:m})}))}}:{}},de=(r,{debounceWait:e,debounceLeading:t,debounceTrailing:n,debounceMaxWait:i})=>{const s=g.useRef(),u=g.useMemo(()=>{const c={};return t!==void 0&&(c.leading=t),n!==void 0&&(c.trailing=n),i!==void 0&&(c.maxWait=i),c},[t,n,i]);return g.useEffect(()=>{if(e){const c=r.runAsync.bind(r);return s.current=Y(f=>{f()},e,u),r.runAsync=(...f)=>new Promise((l,o)=>{var a;(a=s.current)==null||a.call(s,()=>{c(...f).then(l).catch(o)})}),()=>{var f;(f=s.current)==null||f.cancel(),r.runAsync=c}}return()=>{}},[e,u]),e?{onCancel:()=>{var c;(c=s.current)==null||c.cancel()}}:{}},ge=(r,{loadingDelay:e,ready:t})=>{const n=g.useRef();if(!e)return{};const i=()=>{n.current&&clearTimeout(n.current)};return{onBefore:()=>(i(),t!==!1&&(n.current=setTimeout(()=>{r.setState({loading:!0})},e)),{loading:!1}),onFinally:()=>{i()},onCancel:()=>{i()}}},pe=(r,{pollingInterval:e,pollingWhenHidden:t=!0,pollingErrorRetryCount:n=-1})=>{const i=g.useRef(),s=g.useRef(),u=g.useRef(0),c=()=>{var f;i.current&&clearTimeout(i.current),(f=s.current)==null||f.call(s)};return N(()=>{e||c()},[e]),e?{onBefore:()=>(c(),null),onError:()=>{u.current+=1},onSuccess:()=>{u.current=0},onFinally:()=>{n===-1||n!==-1&&u.current<=n?i.current=setTimeout(()=>{!t&&!$()?s.current=q(()=>{r.refresh()}):r.refresh()},e):u.current=0},onCancel:()=>{c()}}:{}};function he(r,e){let t=!1;return(...n)=>{t||(t=!0,r(...n),setTimeout(()=>{t=!1},e))}}const Pe=(r,{refreshOnWindowFocus:e,focusTimespan:t=5e3})=>{const n=g.useRef(),i=()=>{var s;(s=n.current)==null||s.call(n)};return g.useEffect(()=>{if(e){const s=he(r.refresh.bind(r),t);n.current=z(()=>{s()})}return()=>{i()}},[e,t]),E(()=>{i()}),{}},je=(r,{retryInterval:e,retryCount:t})=>{const n=g.useRef(),i=g.useRef(0),s=g.useRef(!1);return t?{onBefore:()=>(s.current||(i.current=0),s.current=!1,n.current&&clearTimeout(n.current),null),onSuccess:()=>{i.current=0},onError:()=>{if(i.current+=1,t===-1||i.current<=t){const u=e??Math.min(1e3*2**i.current,3e4);n.current=setTimeout(()=>{s.current=!0,r.refresh()},u)}else i.current=0},onCancel:()=>{i.current=0,n.current&&clearTimeout(n.current)}}:{}},Re=(r,{throttleWait:e,throttleLeading:t,throttleTrailing:n})=>{const i=g.useRef(),s={};return t!==void 0&&(s.leading=t),n!==void 0&&(s.trailing=n),g.useEffect(()=>{if(e){const u=r.runAsync.bind(r);return i.current=ue(c=>{c()},e,s),r.runAsync=(...c)=>new Promise((f,l)=>{var o;(o=i.current)==null||o.call(i,()=>{u(...c).then(f).catch(l)})}),()=>{var c;r.runAsync=u,(c=i.current)==null||c.cancel()}}return()=>{}},[e,t,n]),e?{onCancel:()=>{var u;(u=i.current)==null||u.cancel()}}:{}};class ve{constructor(e,t,n,i={}){x(this,"pluginImpls");x(this,"count",0);x(this,"state",{loading:!1,params:void 0,response:null,data:void 0,error:null});this.serviceRef=e,this.options=t,this.subscribe=n,this.initState=i,this.state={...this.state,loading:!t.manual,...i}}setState(e={}){this.state={...this.state,...e},this.subscribe()}runPluginHandler(e,...t){const n=this.pluginImpls.map(i=>{var s;return(s=i[e])==null?void 0:s.call(i,...t)}).filter(Boolean);return Object.assign({},...n)}async runAsync(...e){var u,c,f,l,o,a,m,v,C,O;this.count+=1;const t=this.count,{stopNow:n=!1,returnNow:i=!1,...s}=this.runPluginHandler("onBefore",e);if(n)return new Promise(()=>{});if(this.setState({loading:!0,params:e,...s}),i)return Promise.resolve(s.data);(c=(u=this.options).onBefore)==null||c.call(u,e);try{let{servicePromise:h}=this.runPluginHandler("onRequest",this.serviceRef.current,e);h||(h=this.serviceRef.current(...e));const p=await h;return t!==this.count?new Promise(()=>{}):(this.setState({data:p.data,error:null,response:p.response,loading:!1}),(l=(f=this.options).onSuccess)==null||l.call(f,p.data,e),this.runPluginHandler("onSuccess",p,e),(a=(o=this.options).onFinally)==null||a.call(o,e,p.data,null),t===this.count&&this.runPluginHandler("onFinally",e,p,null),p)}catch(h){const p=h;if(t!==this.count)return new Promise(()=>{});throw this.setState({error:p,data:null,response:h.response,loading:!1}),(v=(m=this.options).onError)==null||v.call(m,p,e),this.runPluginHandler("onError",h,e),(O=(C=this.options).onFinally)==null||O.call(C,e,void 0,p),t===this.count&&this.runPluginHandler("onFinally",e,void 0,h),h}}run(...e){this.runAsync(...e).catch(t=>{this.options.onError||console.error(t)})}cancel(){this.count+=1,this.setState({loading:!1}),this.runPluginHandler("onCancel")}refresh(){this.run(...this.state.params||[])}refreshAsync(){return this.runAsync(...this.state.params||[])}mutate(e){const t=V(e)?e(this.state.data):e;this.runPluginHandler("onMutate",t),this.setState({data:t})}}function xe(r,e={},t=[]){const{manual:n=!1,ready:i=!0,...s}=e,u={manual:n,ready:i,...s},c=U(r),f=Z(),l=T(()=>{const o=t.map(a=>{var m;return(m=a==null?void 0:a.onInit)==null?void 0:m.call(a,u)}).filter(Boolean);return new ve(c,u,f,Object.assign({},...o))},[]);return l.options=u,l.pluginImpls=t.map(o=>o(l,u)),D(()=>{if(!n&&i){const o=l.state.params||e.defaultParams||[];l.run(...o)}}),E(()=>{l.cancel()}),{loading:l.state.loading,data:l.state.data,error:l.state.error,params:l.state.params||[],cancel:R(l.cancel.bind(l)),refresh:R(l.refresh.bind(l)),refreshAsync:R(l.refreshAsync.bind(l)),run:R(l.run.bind(l)),runAsync:R(l.runAsync.bind(l)),mutate:R(l.mutate.bind(l))}}function be(r,e,t){return xe(r,e,[de,ge,pe,Pe,Re,J,fe,je])}function we(r){return{label:r.roleName,value:r.roleCode}}const Ke=({open:r,closeDrawer:e,submitted:t,operateType:n,rowData:i})=>{const{t:s}=G(),[u]=P.useForm(),{data:c,run:f}=be(L,{manual:!0}),l=c?c.map(we):[],o=()=>{e(),u.resetFields()};async function a(){var m;await u.validateFields(),(m=window.$message)==null||m.success(s("common.updateSuccess")),e(),t()}return N(()=>{r&&f()},[r]),d.jsx(W,{onClose:o,title:s(n==="add"?"page.manage.user.addUser":"page.manage.user.editUser"),open:r,footer:d.jsxs(K,{justify:"space-between",children:[d.jsx(B,{onClick:o,children:s("common.cancel")}),d.jsx(B,{onClick:a,type:"primary",children:s("common.confirm")})]}),children:d.jsxs(P,{form:u,initialValues:n==="edit"?i:void 0,layout:"vertical",children:[d.jsx(P.Item,{label:s("page.manage.user.userName"),name:"userName",children:d.jsx(w,{placeholder:s("page.manage.user.form.userName")})}),d.jsx(P.Item,{label:s("page.manage.user.userGender"),name:"userGender",children:d.jsx(b.Group,{children:k.map(m=>d.jsx(b,{value:m.value,children:s(m.label)},m.value))})}),d.jsx(P.Item,{label:s("page.manage.user.nickName"),name:"nickName",children:d.jsx(w,{placeholder:s("page.manage.user.form.nickName")})}),d.jsx(P.Item,{label:s("page.manage.user.userPhone"),name:"userPhone",children:d.jsx(w,{placeholder:s("page.manage.user.form.userPhone")})}),d.jsx(P.Item,{label:s("page.manage.user.userEmail"),name:"email",children:d.jsx(w,{placeholder:s("page.manage.user.form.userEmail")})}),d.jsx(P.Item,{label:s("page.manage.user.userStatus"),name:"status",children:d.jsx(b.Group,{children:I.map(m=>d.jsx(b,{value:m.value,children:s(m.label)},m.value))})}),d.jsx(P.Item,{label:s("page.manage.user.userRole"),name:"roles",children:d.jsx(ee,{options:l,placeholder:s("page.manage.user.form.userRole")})})]})})};export{Ke as default};
